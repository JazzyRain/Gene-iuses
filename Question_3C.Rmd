---
title: "Question_3C"
author: "Janis Cheng"
date: "05/04/2021"
output: html_document
---

# Introduction
##### Dogs have different personalities and behavioural traits. This script aimed to construct a visualization of behavioural traits of dogs, based on a dataset collected by Ilska et al.. The purpose of this tree is to explore the behavioural traits important for dog domestication as a pet. This also shows a proof of concept of a method that would allow us to understand the similarities of demeanor between different dogs as a pet. For example, some people prefer quiet, relaxed pets, but some people might prefer excited, energetic pets. One can use this tree to predict the relationship and characteristic that they will have with their dog when they are deciding to become an owner. 

##### The original dataset has 1975 data entries, each measured in 12 dog beahvioural traits. In this script, we are only analyzing the first 500 due to computational power. The numeric measurements were encoded in binary. This dataset also did not include the species of the dogs serveyed, therefore this can only be used as a proof of concept, since we can't actually identify the dogs. Had the species been included, this can elucidate the atmosphere of the relationship that they will have with their owner.

##### The 12 behavioural traits are as follows:
1. Agitated when ignored
2. Attention seeking behaviour
3. Barking tendencies
4. Excitatbility
5. Fetching
6. Human & object fear
7. Noise fear
8. Non-owner directed aggression
9. Owner-directed aggression
10. Separation anxiety
11. Trainability
12. Unusual behaviour
#### The traits were measure in a scale from 1-5. During the encoding of these measurements into binary, these measurements were rounded to the nearest whole number. 

#### These traits were then rated in importance of social consequences of the dogs as a pet (ease of having this dog as a pet).

#### Import data
```{r}
library(ape) #the read.nexus is from the ape package
DogData<-read.nexus.data("DogData.nex") #nexus file of the data
```

#### Importing weight data
##### The weights will help construct the tree
```{r}
WeightsDat<-read.csv("Weights.csv")
WeightsDat
```

#### Applying the weight
#### Create a single vector of weights:
```{r}
Weights<-paste0(WeightsDat$Weight,collapse="")
Weights<-strsplit(Weights,split="")[[1]]

WeightsNum<-rep(NA,length(Weights)) #replicate the values into a blank dataframe
for(i in 1:length(WeightsNum)){ #goes through the length of the 
  if(Weights[i] %in% LETTERS){ #if that cell contains anything that is a Letter (in the letter list/ category)
    WeightsNum[i]<-which(LETTERS==Weights[i])+9 #since the largest single digit used in the weight is 9, everything after is at least 9
  } else {
    WeightsNum[i]<-Weights[i] #if it doesnt carry any letters
  }
}

WeightsNum<-as.numeric(Weights)
```

#### Multiply the weight value by the trait vector for each data entry
```{r}
DogNexus<-DogData # Make a new weighted data frame object
for (i in 1:length(DogData)){ #goes through every line of the dataframe 
  RepWeight<-DogData[[i]]==1 #slice out everything that is 1 I think
  DogNexus[[i]][RepWeight]<-WeightsNum[RepWeight] # in the dataframe, for the selected 1 elements, each of them would be what the multiplied version be
  RepWeight<-NA 
}
```

#### Distance matrix
```{r}
DogNexusDF<-data.frame(matrix(unlist(DogNexus),ncol=47,byrow=T)) #form the dataframe
row.names(DogNexusDF)<-names(DogNexus) #name each row by the dog name (aka data entry number)
DogDist<-dist(DogNexusDF,method='euclidean') #euclidean, much stronger structure

DogDistMat<-as.matrix(DogDist) #make it into matrix
```

#### To visualize the matrix
```{r}
library(reshape2) #load library
DogDistMat_2<-melt(DogDistMat) #turn it into linear matrix

#Plot it
library(ggplot2)
ggplot(data = DogDistMat_2, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+scale_fill_gradientn(colours=c("white","blue","yellow","red")) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

ggsave(path = "./Question_3_Figures", filename = "3C_Distance matrix.pdf" , device = "pdf", width = 20, height = 12 , units = "in" , limitsize = FALSE)##save the plot as pdf
```

#### Making the Tree
```{r}
library(ggtree)
DogTree<-fastme.bal(DogDist) #ME
ggtree(DogTree,layout="circular",branch.length='none') +geom_tiplab(size=2,aes(angle=angle)) 

ggsave(path = "./Question_3_Figures", filename = "3C_Dog_Tree.pdf" , device = "pdf", width = 20, height = 12 , units = "in" , limitsize = FALSE)##save the tree as pdf
```


